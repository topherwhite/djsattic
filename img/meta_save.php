<?phprequire '../includes/mySQL_Sessions.inc';require '../includes/TableRelated.inc';session_start();	if (empty($_SESSION['idnum']))	{ die("No User Specified"); }$idnum[0] = $_SESSION['idnum'];$sess_id = session_id();$key = dechex(mktime());$TbleGrp = GenerateTableGroup($_SESSION['idnum']);$clean['type'] = ereg_replace('\'', '`', $_GET['type']);$clean['refnum'] = ereg_replace('\'', '`', $_GET['refnum']);$refnum = mysqlclean($clean,'refnum',8,$connection);if ($clean['type'] == 'cmnt'){	$clean['cmnt'] = ereg_replace('\'', '`', $_POST['cmnt']);	$cmnt = mysqlclean($clean,'cmnt',300,$connection);	$query['SaveCmnt'] = "UPDATE {$TbleGrp['uploads']} SET cmnt='{$cmnt}' WHERE rank={$refnum}";	if (@mysql_query($query['SaveCmnt'],$connection))	{	header("Location: ../img/meta.php?type=cmnt&sess={$sess_id}&key={$key}&refnum={$refnum}");		exit;}	}elseif	($clean['type'] == 'title'){	$clean['title'] = ereg_replace('\'', '`', $_POST['title']);	$title = mysqlclean($clean,'title',50,$connection);	$query['UpdateTitle'] =	"UPDATE {$TbleGrp['lists']} SET title='{$title}' WHERE rank={$_SESSION['curr_alb']}";	if (@mysql_query($query['UpdateTitle'], $connection))	{	header("Location: meta.php?sess={$sess_id}&key={$key}&m=alrn&type=title&refnum={$refnum}&ttl=edt");		exit;}	}elseif	($clean['type'] == 'addph'){	if (empty($refnum))	{	header("Location: meta.php?sess={$sess_id}&key={$key}&type=opt&m=noref");	exit;	}	$query['GetNum'] = "SELECT numcol FROM pageinfo WHERE idnum={$idnum[0]}";	if ($info = @mysql_fetch_array(@mysql_query($query['GetNum'],$connection)))	{	$NumCols = $info['numcol'];		$query['GetItems'] = "SELECT * FROM items WHERE idnum={$idnum[0]}";		if ($itms = @mysql_fetch_array(@mysql_query($query['GetItems'],$connection)))		{	for($col = 0; $col < 4; $col++)				{	for($itm = 0; $itm < 8; $itm++)					{	$name = "c{$col}i{$itm}";					if ($itms[$name] == $refnum)	$ExistsAt = $name;			}	}			if (!(empty($ExistsAt)))	$status = "imgprs";			else			{	for($itm = 0; $itm < 8; $itm++)				{	for($col = 0; $col < $NumCols; $col++)						{	$name = "c{$col}i{$itm}";						if ($itms[$name] == 0)						{	$OpenAt = $name;	break;					}	}					if (!(empty($OpenAt)))		break;				}				if (empty($OpenAt))	$status = "pgfl";				elseif	(!(empty($OpenAt)))				{	$query['AddItem'] = "UPDATE items SET {$OpenAt}={$refnum} WHERE idnum={$idnum[0]}";					if (@mysql_query($query['AddItem'],$connection))	$status = "adphsc";					else												$status = "adphfl";			}	}			header("Location: meta.php?sess={$sess_id}&key={$key}&m={$status}&type=opt&refnum={$refnum}");			exit;}	}	}elseif	($clean['type'] == 'addalb'){	$query['GetNumCols'] = "SELECT numcol FROM pageinfo WHERE idnum={$idnum[0]}";	$Page = @mysql_fetch_array(@mysql_query($query['GetNumCols'], $connection));		$query['GetItms'] = "SELECT * FROM items WHERE idnum={$idnum[0]}";	$Itms = @mysql_fetch_array(@mysql_query($query['GetItms'], $connection));		$query['CheckExists'] = "SELECT rank, file FROM {$TbleGrp['uploads']} WHERE idnum={$idnum[0]} AND type='alb'";	$query['GetNumAlbs'] = "SELECT count(*) as cnt FROM {$TbleGrp['uploads']} WHERE idnum={$idnum[0]} AND type='alb'";	if ($cnt = @mysql_fetch_array(@mysql_query($query['GetNumAlbs'],$connection)))	{	if ($cnt['cnt'] != 0)		{	if ($check = @mysql_query($query['CheckExists'],$connection))			{	for ($i = 1; $i <= $cnt['cnt']; $i++)				{	$orig = @mysql_fetch_array($check);					if ($orig['file'] == $_SESSION['curr_alb'])					{	$query['DeleteOrig'] = "DELETE FROM {$TbleGrp['uploads']} WHERE rank={$orig['rank']}";						@mysql_query($query['DeleteOrig'], $connection);												for ($itmrep = 0; $itmrep < 8; $itmrep++)						{	for ($colrep = 0; $colrep < $Page['numcol']; $colrep++)							{	$name = "c{$colrep}i{$itmrep}";								if ($Itms[$name] == $orig['rank'])								{	$ExistsAt = $name;									$query['ItmAdvance'] = "UPDATE items SET ";									for ($rep = $itmrep; $rep < 7; $rep++)									{	$nxt = $rep+1;										$query['ItmAdvance'] .= "c{$colrep}i{$rep}=c{$colrep}i{$nxt}";										if ($rep < 6)	$query['ItmAdvance'] .= ", ";									}									$query['ItmAdvance'] .= " WHERE idnum={$idnum}";									@mysql_query($query['ItmAdvance'],$connection);	}	}	}	}	}	}	}	}	if (empty($ExistsAt))	{	for ($itmrep = 0; $itmrep < 8; $itmrep++)		{	for ($colrep = 0; $colrep < $Page['numcol']; $colrep++)			{	$name = "c{$colrep}i{$itmrep}";				if ($Itms[$name] == 0)				{	$EmptyAt = $name;	break;			}	}			if (!(empty($EmptyAt)))	break;	}	}		if (!(empty($ExistsAt))) {	$WriteTo = $ExistsAt;	$status='albex';	}	else					 {	$WriteTo = $EmptyAt;	$status='albad';	}		$query['AddToTble'] = "INSERT INTO {$TbleGrp['uploads']} SET idnum={$idnum[0]}, type='alb', file={$_SESSION['curr_alb']}";	$query['GetNewRank'] = "SELECT rank FROM {$TbleGrp['uploads']} WHERE idnum={$idnum[0]} AND type='alb' AND file={$_SESSION['curr_alb']}";	if (@mysql_query($query['AddToTble'], $connection))	{	if ($new = @mysql_fetch_array(@mysql_query($query['GetNewRank'], $connection)))		{	$query['UpdateItems'] = "UPDATE items SET {$WriteTo}={$new['rank']} WHERE idnum={$idnum[0]}";			if (@mysql_query($query['UpdateItems'], $connection))			{	header("Location: meta.php?sess={$sess_id}&key={$key}&m={$status}&type=opt&refnum={$refnum}");				exit;	}	}	}}elseif	($clean['type'] == 'mkprf'){	$query['GetFileName'] =	"SELECT file FROM {$TbleGrp['uploads']} WHERE rank={$refnum}";	if ($file = @mysql_fetch_array(@mysql_query($query['GetFileName'],$connection)))	{	$query['UpdateProf'] =	"UPDATE pageinfo SET prof_pic={$file['file']} WHERE idnum={$idnum[0]}";		if (@mysql_query($query['UpdateProf'], $connection))		{	header("Location: meta.php?sess={$sess_id}&key={$key}&m=prfph&type=opt&refnum={$refnum}");			exit;}	}	}/*elseif ($clean['type'] == 'artist'){	$clean['artist'] = ereg_replace('\'', '`', $_POST['artist']);	$artist = mysqlclean($clean,'artist',50,$connection);	$query['SaveArtist'] = "UPDATE {$TbleGrp['uploads']} SET artist='{$artist}' WHERE rank={$refnum}";	if (@mysql_query($query['SaveArtist'],$connection))	{	header("Location: ../aud/meta.php?type=artist&sess={$sess_id}&key={$key}&refnum={$refnum}&nxtaud={$nxtaud}&art=edt");		exit;}	}*/?>