<?phprequire '../includes/DirectoryRelated.inc';require '../includes/UploadFileManip.inc';require '../includes/MySQL_Sessions.inc';require '../includes/TableRelated.inc';session_start();	if (empty($_SESSION['idnum']))	{ die("No User Specified"); }$idnum[0] = $_SESSION['idnum'];$sess_id = session_id();$key = dechex(mktime());$TbleGrp = GenerateTableGroup($idnum[0]);$RtrnHeader = "Location: library.php?sess={$sess_id}&key={$key}&nxtaud={$_GET['nxtaud']}&reload=playlist";if (empty($_GET['refnum']))		{	header($RtrnHeader);	exit;	}else								$refnum = mysqlclean($_GET, 'refnum', 8, $connection);$query['GetInfo'] =		"SELECT type, file, ext FROM {$TbleGrp['uploads']} WHERE rank = '{$refnum}'";$query['DeleteRow'] = 	"DELETE FROM {$TbleGrp['uploads']} WHERE rank = '{$refnum}'";$query['UpdateCount'] = "UPDATE filecount SET numaudio = numaudio - 1 WHERE idnum = '{$idnum[0]}'";$query['NumRows'] =		"SELECT audlists FROM filecount WHERE idnum = {$idnum[0]}";$query['AudLists'] =	"SELECT * FROM {$TbleGrp['lists']} WHERE idnum={$idnum[0]} AND type='aud'";if ($info = @mysql_fetch_array(@mysql_query($query['GetInfo'],$connection))){	if ($info['type'] == 'aud')	{	if ((@mysql_query($query['DeleteRow'],$connection)) && (@mysql_query($query['UpdateCount'],$connection)))		{	if ($num = @mysql_fetch_array(@mysql_query($query['NumRows'],$connection)))			{	if ($lists=@mysql_query($query['AudLists'],$connection))				{	for ($rep = 1; $rep <= $num['audlists']; $rep++)					{	$audlist = @mysql_fetch_array($lists);						for ($cntr = 1; $cntr <= 20; $cntr++)						{	if ($audlist["itm{$cntr}"] == $refnum)							{	$query['EraseSong'] = "UPDATE {$TbleGrp['lists']} SET ";								for ($i = $cntr; $i < 20; $i++)								{	$query['EraseSong'] .= "itm{$i}=itm" . ($i + 1);									if	($i < 19)	$query['EraseSong'] .= ", ";								}								$query['EraseSong'] .= " WHERE rank={$audlist['rank']}";								@mysql_query($query['EraseSong'],$connection);					}	}	}					$dir = "/cluster/harry/aud/mp3/" . GenerateFullImageDirectoryPath($idnum[0]);					$file = "{$idnum[0]}.{$info['file']}.{$info['ext']}";					exec(DeleteUploadedFile($dir,$file,'aud'));}	}	}	}	}header($RtrnHeader);exit;?>