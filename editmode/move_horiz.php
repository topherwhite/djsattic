<?phprequire '../includes/mySQL_Sessions.inc';session_start();	if (empty($_SESSION['idnum']))	{ header("Location: http://www.mysimum.com/"); exit; }$idnum = $_SESSION['idnum'];$sess_id = session_id();$loc = $_GET['loc'];$th = $_GET['th'];$key = dechex(mktime());$nmcl = mysqlclean($_GET,'nmcl',1,$connection);$dir = mysqlclean($_GET,'dir',2,$connection);$cl = mysqlclean($_GET,'cl',1,$connection);$it = mysqlclean($_GET,'it',1,$connection);if (($nmcl <= 4) && ($nmcl >= 1))	$numcol = intval($nmcl) - 1;else								$numcol = 3;if (($dir != 'lf') && ($dir != 'rt')){	header("Location: ../user/items.php?sess={$sess_id}&loc={$loc}&th={$th}&key={$key}&edit=1&status=baddir");	exit;	}elseif ( ($cl < 0) || ($cl >= $nmcl) || ($it < 0) || ($it > 7) ){	header("Location: ../user/items.php?sess={$sess_id}&loc={$loc}&th={$th}&key={$key}&edit=1&status=badloc");	exit;	}elseif ((($cl == 0) && ($dir == 'lf')) || (($cl == $numcol) && ($dir == 'rt'))){	header("Location: ../user/items.php?sess={$sess_id}&loc={$loc}&th={$th}&key={$key}&edit=1&status=range");	exit;	}if ($dir == 'lf')		$DstCl = ($cl - 1);elseif ($dir == 'rt')	$DstCl = ($cl + 1);$query['ChckDestCol'] = "SELECT c{$DstCl}i0, c{$DstCl}i1, c{$DstCl}i2, c{$DstCl}i3, "					.	"c{$DstCl}i4, c{$DstCl}i5, c{$DstCl}i6, c{$DstCl}i7"					.	" FROM items WHERE idnum={$idnum}";$ChckDest = @mysql_fetch_array(@mysql_query($query['ChckDestCol'],$connection));if ($ChckDest["c{$DstCl}i7"] != 0){	header("Location: ../user/items.php?sess={$sess_id}&loc={$loc}&th={$th}&key={$key}&edit=1&status=colfull");	exit;}if ($ChckDest["c{$DstCl}i{$it}"] == 0){	for ($itmchk = $it; (($ChckDest["c{$DstCl}i{$itmchk}"] == 0) && ($itmchk >= 0)); $itmchk--)	{	$WriteTo = $itmchk;}	}else	$WriteTo = $it;$query['update'] = "UPDATE items SET ";for ($rep = 7; $rep > $WriteTo; $rep--){	$nxt = $rep-1;	$query['update'] .= "c{$DstCl}i{$rep}=c{$DstCl}i{$nxt}, ";}$query['update'] .= "c{$DstCl}i{$WriteTo}=c{$cl}i{$it}, ";for ($rep = $it; $rep < 7; $rep++){	$nxt = $rep+1;	$query['update'] .= "c{$cl}i{$rep}=c{$cl}i{$nxt}, ";	if ($rep == 6) $query['update'] .= "c{$cl}i{$nxt}=0";}$query['update'] .= " WHERE idnum={$idnum}";if (@mysql_query($query['update'],$connection)){	header("Location: ../user/items.php?sess={$sess_id}&loc={$loc}&th={$th}&key={$key}&edit=1&status=succ");	exit;}else	die("Update Failed");header("Location: ../user/items.php?sess={$sess_id}&loc={$loc}&th={$th}&key={$key}&edit=1");exit;?>