<?xml version="1.0" encoding="UTF-8"?><djsattic><?phpheader('Content-type: text/xml');require_once '../../includes/mySQL_Sessions.inc';require_once '../../includes/TableRelated.inc';require_once '../../includes/DirectoryRelated.inc';session_start();	if (empty($_SESSION['idnum']))	{ die(); }$TbleGrp = GenerateTableGroup($_SESSION['idnum']);$ref = intval(mysqlclean($_GET,'ref',8,$connection));$gnreRef = ""; $artRef = ""; $albRef = "";$ins = "AND type='aud' ";if ($_GET['gn'] != 'empty'){	$gnreRef = mysqlclean($_GET,'gn',32,$connection);		$ins .= "AND MD5genre='{$gnreRef}' ";}if ($_GET['ar'] != 'empty'){	$artRef = mysqlclean($_GET,'ar',32,$connection);		$ins .= "AND MD5artist='{$artRef}' ";}if ($_GET['al'] != 'empty'){	$albRef = mysqlclean($_GET,'al',32,$connection);		$ins .= "AND MD5album='{$albRef}' ";}$query['GetNum'] = "SELECT COUNT(*) AS cnt FROM {$TbleGrp['uploads']} WHERE idnum={$_SESSION['idnum']} {$ins}";		$query['GetSong'] = "SELECT type,file,ext,MD5artist,MD5album FROM {$TbleGrp['uploads']} WHERE rank={$ref}";		if ($sng = @mysql_fetch_array(@mysql_query($query['GetSong'],$connection)))	{		//	remove from any playlists, if contained therein		$query['GetPlsts'] = "SELECT * FROM {$TbleGrp['lists']} WHERE idnum={$_SESSION['idnum']} AND type='aud'";		$query['NumPlsts'] = "SELECT COUNT(*) AS nmbr FROM ({$query['GetPlsts']}) AS audlists";				if ( ($lsts = @mysql_fetch_array(@mysql_query($query['NumPlsts'],$connection))) && ($lsts['nmbr'] != 0) )		{	$query['GetPlsts'] .= " LIMIT {$lsts['nmbr']}";			$GetLst = @mysql_query($query['GetPlsts'],$connection);			$lstremovals = 0;			for ($i = 1; $i <= 4; $i++)			{	$lst[$i] = @mysql_fetch_array($GetLst);				for ($itm = 50; $itm >= 1; $itm--)				{	if ($lst[$i]["itm{$itm}"] == $ref)					{	$query['LstRem'] = "UPDATE {$TbleGrp['lists']} SET ";						for ($rep = $itm; $rep < 50; $rep++)	$query['LstRem'] .= "itm{$rep}=itm".($rep+1).",";						$query['LstRem'] .= "itm50=0 WHERE rank={$lst[$i]['rank']}";						if (@mysql_query($query['LstRem'],$connection))							$lstremovals = $lstremovals+1;			}	}	}			echo "<lstremovals>{$lstremovals}</lstremovals>";		}		//	if last song of an album, remove album information		$lastofalb = 0;		$query['AlbCnt'] = "SELECT COUNT(*) AS albcnt FROM ("					.	"SELECT * FROM {$TbleGrp['uploads']} WHERE idnum={$_SESSION['idnum']} AND type='aud'"					.	" AND MD5artist='{$sng['MD5artist']}' AND MD5album='{$sng['MD5album']}'"					.	") AS samealb";		if ( ($alb = @mysql_fetch_array(@mysql_query($query['AlbCnt'],$connection))) && ($alb['albcnt'] < 2) )		{	$query['RemAlb'] = "DELETE FROM {$TbleGrp['albms']} WHERE idnum={$_SESSION['idnum']} AND"							.	" MD5s='{$sng['MD5artist']}_{$sng['MD5album']}'";			@mysql_query($query['RemAlb'],$connection);			$lastofalb = 1;		}		echo "<lastofalb>1</lastofalb>";//	now, remove song and delete file, then update filecount				$query['DelSong'] = "DELETE FROM {$TbleGrp['uploads']} WHERE rank={$ref}";		$query['UpdCnt'] = "UPDATE filecount SET numaudio=numaudio-1 WHERE idnum={$_SESSION['idnum']}";		$sh_DelSong = "rm /cluster/harry/aud/mp3/" . GenerateFullImageDirectoryPath($_SESSION['idnum'])					. "{$_SESSION['idnum']}.{$sng['file']}.{$sng['ext']}";		if (@mysql_query($query['DelSong'],$connection))		{	if (@mysql_query($query['UpdCnt'],$connection))			{	exec($sh_DelSong);				echo "<status>1</status>";		}	}					}	echo "<ypos>" . $ypos . "</ypos>"	."<sess>" . session_id() . "</sess>";?></djsattic>